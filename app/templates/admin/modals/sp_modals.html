<!-- Add Service Provider Modal -->
<div class="modal fade" id="addSpModal" tabindex="-1" aria-labelledby="addSpModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered">
    <div class="modal-content bg-dark">
      <form method="POST" action="{{ url_for('admin.create_sp') }}">
        <div class="modal-header">
          <h5 class="modal-title" id="addSpModalLabel"><i class="bi bi-building me-2"></i>Add New Service Provider</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

          <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" name="name" class="form-control" placeholder="e.g., My Application" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Entity ID</label>
            <input type="text" name="entity_id" class="form-control" placeholder="e.g., https://app.example.com/saml/metadata" required>
          </div>

          <div class="mb-3">
            <label class="form-label">ACS URL (Assertion Consumer Service)</label>
            <input type="text" name="acs_url" class="form-control" placeholder="e.g., https://app.example.com/saml/acs" required>
          </div>

          <h6 class="mt-4 mb-3"><i class="bi bi-diagram-3 me-2"></i>Attribute Mapping</h6>
          <p class="form-text mb-3">Map user fields to SAML claims expected by this Service Provider.</p>

          <div class="table-responsive">
            <table class="table table-dark align-middle mb-0">
              <thead>
                <tr>
                  <th>Claim Name</th>
                  <th>User Field</th>
                  <th style="width: 60px;">Actions</th>
                </tr>
              </thead>
              <tbody id="claims-body">
                <tr>
                  <td><input name="claim_name_0" class="form-control form-control-sm" value="emailaddress" required></td>
                  <td>
                    <select name="claim_value_0" class="form-select form-select-sm" required>
                      {% for field in user_fields %}
                        <option value="{{ field }}" {{ 'selected' if field == 'email' else '' }}>{{ field }}</option>
                      {% endfor %}
                    </select>
                  </td>
                  <td class="text-center">
                    <button type="button" class="btn btn-sm btn-outline-danger remove-claim"><i class="bi bi-trash"></i></button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="mt-3">
            <button type="button" class="btn btn-outline-primary btn-sm" id="add-claim-btn">
              <i class="bi bi-plus-lg me-1"></i>Add Claim
            </button>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success"><i class="bi bi-save me-1"></i>Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit Service Provider Modal -->
<div class="modal fade" id="editSpModal" tabindex="-1" aria-labelledby="editSpModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered">
    <div class="modal-content bg-dark">
      <form method="POST" action="/admin/service-providers/0/edit" id="edit-sp-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div class="modal-header">
          <h5 class="modal-title" id="editSpModalLabel"><i class="bi bi-pencil me-2"></i>Edit Service Provider</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" name="name" id="edit_sp_name" class="form-control" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Entity ID</label>
            <input type="text" name="entity_id" id="edit_sp_entity_id" class="form-control" required>
          </div>

          <div class="mb-3">
            <label class="form-label">ACS URL (Assertion Consumer Service)</label>
            <input type="text" name="acs_url" id="edit_sp_acs_url" class="form-control" required>
          </div>

          <h6 class="mt-4 mb-3"><i class="bi bi-diagram-3 me-2"></i>Attribute Mapping</h6>
          <p class="form-text mb-3">Modify the SAML claim mappings below.</p>

          <div class="table-responsive">
            <table class="table table-dark align-middle mb-0">
              <thead>
                <tr>
                  <th>Claim Name</th>
                  <th>User Field</th>
                  <th style="width: 60px;">Actions</th>
                </tr>
              </thead>
              <tbody id="edit-claims-body">
                <!-- Dynamically filled via JS -->
              </tbody>
            </table>
          </div>

          <div class="mt-3">
            <button type="button" class="btn btn-outline-primary btn-sm" id="edit-add-claim-btn">
              <i class="bi bi-plus-lg me-1"></i>Add Claim
            </button>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success"><i class="bi bi-save me-1"></i>Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>
